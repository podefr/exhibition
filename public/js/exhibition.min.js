require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var Collections=require("./uis/Collections"),Photosets=require("./uis/Photosets"),Collage=require("./uis/Collage"),Slideshow=require("./uis/Slideshow"),LocationRouter=require("olives").LocationRouter,Navigation=require("./uis/Navigation"),Stack=require("emily").Stack;module.exports=function Exhibition($dataProvider){var _dataProvider=$dataProvider,_locationRouter=new LocationRouter,_collections=null,_photosets=null,_collage=null,_slideshow=null,_stack=null,_currentPhotosetId="",_currentPhotoIndex=0,_photosetUpdateHandle=null,_slideShowUpdateHandle=null;this.start=function start(){this.initStack();this.initNavigation();this.initCollections();this.initPhotosets();this.initCollage();this.initSlideshow();_stack.hideAll();_locationRouter.start("home")};this.initStack=function initStack(){_stack=new Stack;_stack.place(document.querySelector(".main"))};this.initCollections=function initCollections(){_collections=new Collections(_dataProvider.getCollections());_collections.template=document.querySelector(".collections");_collections.render();_stack.add(_collections.dom);_collections.watch("drillin",function(id){_locationRouter.navigate("photosets",id)})};this.initPhotosets=function initPhotosets(){_photosets=new Photosets;_photosets.template=document.querySelector(".photosets");_photosets.render();_stack.add(_photosets.dom);_photosets.watch("drillin",function(id){_locationRouter.navigate("photoset",id)})};this.initCollage=function initcollage(){_collage=new Collage;_collage.template=document.querySelector(".collage");_collage.render();_collage.watch("startSlideshow",function(photoIndex){_locationRouter.navigate("slideshow",_currentPhotosetId,photoIndex)});_stack.add(_collage.dom)};this.initSlideshow=function initSlideshow(){_slideshow=new Slideshow;_slideshow.template=document.querySelector(".slideshow");_slideshow.render();_stack.add(_slideshow.dom)};this.initNavigation=function initNavigation(){_navigation=new Navigation(_locationRouter);_navigation.alive(document.querySelector(".navigation"));_navigation.watch("back",_locationRouter.back,_locationRouter);_navigation.watch("home",function(){_locationRouter.navigate("home")});_stack.add(_navigation.dom)};_locationRouter.set("home",function(){_stack.transit(_collections.dom);_stack.hide(_navigation.dom)});_locationRouter.set("photosets",function(id){_photosets.setPhotosets(_dataProvider.getPhotosetsForCollection(id));_stack.transit(_photosets.dom);_stack.show(_navigation.dom)});_locationRouter.set("photoset",function(id){_currentPhotosetId=id;_dataProvider.unsubscribeToPhotosetChanges(_photosetUpdateHandle);_collage.setPhotoset(_dataProvider.getPhotosFromPhotoset(id));_photosetUpdateHandle=_dataProvider.subscribeToPhotosetChanges(id,function(newValue){_collage.setPhotoset(newValue)});_stack.transit(_collage.dom);_stack.show(_navigation.dom)});_locationRouter.set("slideshow",function(photosetId,photoIndex){_currentPhotosetId=photosetId;_currentPhotoIndex=+photoIndex;_dataProvider.unsubscribeToPhotosetChanges(_slideShowUpdateHandle);_slideshow.setPhotoset(_dataProvider.getPhotosFromPhotoset(_currentPhotosetId));_slideshow.setPhotoIndex(_currentPhotoIndex);_slideShowUpdateHandle=_dataProvider.subscribeToPhotosetChanges(photosetId,function(newValue){_slideshow.setPhotoset(newValue);_slideshow.setPhotoIndex(_currentPhotoIndex)});_stack.transit(_slideshow.dom);_stack.show(_navigation.dom)});_locationRouter.watch(function(route){var body=document.querySelector("body");body.dataset.route=route;window.scrollTo(0,0)})}},{"./uis/Collage":7,"./uis/Collections":8,"./uis/Navigation":9,"./uis/Photosets":10,"./uis/Slideshow":11,emily:19,olives:26}],2:[function(require,module,exports){var tools=require("emily").Tools,Store=require("emily").Store;module.exports=function FlickrAdapterConstructor($flickr,$apiKey){var _flickr=$flickr||null,_photosets=new Store([]),_collections=new Store([]),_photos=new Store({}),_apiKey=$apiKey||"";this.requests={getUserId:function getUserId(username){return{method:"flickr.people.findByUsername",username:username,format:"json",api_key:_apiKey}},getPhotosets:function getPhotosets(userId){return{method:"flickr.photosets.getList",user_id:userId,format:"json",api_key:_apiKey}},getCollections:function getCollections(userId){return{method:"flickr.collections.getTree",user_id:userId,format:"json",api_key:_apiKey}},getPhotosForPhotoset:function getPhotosForPhotoset(photosetId){return{method:"flickr.photosets.getPhotos",photoset_id:photosetId,format:"json",api_key:_apiKey}}};this.setFlickr=function setFlickr(flickr){_flickr=flickr};this.getFlickr=function getFlickr(){return _flickr};this.setApiKey=function setApiKey(apiKey){_apiKey=apiKey};this.getApiKey=function getApiKey(){return _apiKey};this.doApiCall=function doApiCall(){var request=this.requests[arguments[0]].apply(null,tools.toArray(arguments).splice(1));return _flickr.get(request).then(function assertResult(result){if(result.stat=="fail"){console.error("Flickr API call ",request," failed with error ",result);throw new Error("Flickr API call ",request," failed with error ",result)}return result})};this.init=function init(username){var userId="";return this.doApiCall("getUserId",username).then(function setUserId(result){userId=result.user.id}).then(function getCollections(){return this.doApiCall("getCollections",userId)},this).then(function(collections){_collections.reset(collections.collections.collection)},this).then(function getPhotosets(){return this.doApiCall("getPhotosets",userId)},this).then(function(photoset){_photosets.watch("added",this.onAddPhotoset,this);_photosets.reset(photoset.photosets.photoset)},this)};this.onAddPhotoset=function onAddPhotoset(index,photoset){this.doApiCall("getPhotosForPhotoset",photoset.id).then(function(result){_photos.set(photoset.id,result.photoset.photo)})};this.getPhotosets=function getPhotosets(){return _photosets.proxy("map",function(photoset){return{server:photoset.server,id:photoset.primary,photoset_id:photoset.id,secret:photoset.secret,farm:photoset.farm,title:photoset.title._content}})};this.getPhotosFromPhotoset=function getPhotosFromPhotoset(photosetId){return _photos.get(photosetId)};this.subscribeToPhotosetChanges=function subscribeToPhotosetChanges(id,func,scope){return _photos.watchValue(id,func,scope)};this.unsubscribeToPhotosetChanges=function unsubscribeToPhotosetChanges(handle){return handle&&_photos.unwatchValue(handle)};this.getPhotoset=function getPhotoset(index){return _photosets.get(index).map(function(photo){return{server:photo.server,id:photo.primary,photoset_id:photo.id,secret:photo.secret,farm:photo.farm,title:photo.title._content}})};this.getPhotosetById=function getPhotosetById(id){var returnPhotoset;_photosets.proxy("some",function(photoset){if(photoset.id==id){returnPhotoset=photoset;return true}});return returnPhotoset};this.getCollections=function getCollections(){return _collections.proxy("map",function(collection){var photosetId=collection.set[0].id,photo=this.getPhotosetById(photosetId);return{collection_id:collection.id,server:photo.server,id:photo.primary,secret:photo.secret,farm:photo.farm,title:collection.title,description:collection.description,iconlarge:collection.iconlarge,iconesmall:collection.iconsmall}},this)};this.getPhotosetsForCollection=function getPhotosetsForCollection(collectionId){var collection;_collections.proxy("some",function(coll){if(coll.id==collectionId){collection=coll;return true}});if(!collection){return false}else{return collection.set.map(function(photoset){var photoset=this.getPhotosetById(photoset.id);return{collection_id:collection.id,photoset_id:photoset.id,server:photoset.server,id:photoset.primary,secret:photoset.secret,farm:photoset.farm,title:photoset.title._content}},this)}}}},{emily:19}],3:[function(require,module,exports){module.exports={hide:function(value){if(value){this.style.display="none"}else{this.style.display=""}},show:function(value){if(!value){this.style.display="none"}else{this.style.display=""}},background:function(url){this.style.backgroundImage="url("+url+")"}}},{}],"8g7Ub6":[function(require,module,exports){var flickr=require("jsonp-flickr"),FlickrAdapter=require("./adapters/Flickr"),Exhibition=require("./Exhibition");module.exports={init:function init(config){var flickrAdapter=new FlickrAdapter(flickr,config.Flickr.api_key);var exhibition=new Exhibition(flickrAdapter);var contact=document.querySelector(".contact-link");contact.innerHTML=config.Exhibition.mail.text;contact.href="mailto:"+config.Exhibition.mail.address;if(config.Exhibition.title){document.title=config.Exhibition.title}flickrAdapter.init(config.Flickr.username).then(function(){exhibition.start()},function(err){console.error("Failed initializing the flickr Adapter.",err)})}}},{"./Exhibition":1,"./adapters/Flickr":2,"jsonp-flickr":20}],exhibition:[function(require,module,exports){module.exports=require("8g7Ub6")},{}],6:[function(require,module,exports){module.exports={createUrl:function createUrl(content,size){if(content){var url="http://farm"+content.farm+".staticflickr.com/"+content.server+"/"+content.id+"_"+content.secret;if(size){url+="_"+size}return url+".jpg"}else{return false}}}},{}],7:[function(require,module,exports){var OObject=require("olives").OObject,Bind=require("olives")["Bind.plugin"],Events=require("olives")["Event.plugin"],flickrContent=require("../services/flickrContent"),Store=require("emily").Store,Observable=require("emily").Observable,Tools=require("emily").Tools,helpers=require("../adapters/helpers");function CollageConstructor(){var collageModel=new Store([]),collage=new Bind(collageModel,helpers),events=new Events(this);this.plugins.addAll({collage:collage,events:events});this.startSlideshow=function startSlideshow(ev,dom){this.notify("startSlideshow",collage.getItemIndex(dom))};this.setPhotoset=function setPhotoset(photoset){if(!photoset){return false}collageModel.reset(photoset.map(function(photo){photo.url=flickrContent.createUrl(photo,"z");return photo}))}}module.exports=function CollageFactory(){Tools.mixin(new OObject,CollageConstructor.prototype);Tools.mixin(new Observable,CollageConstructor.prototype);return new CollageConstructor}},{"../adapters/helpers":3,"../services/flickrContent":6,emily:19,olives:26}],8:[function(require,module,exports){var OObject=require("olives").OObject,Bind=require("olives")["Bind.plugin"],Event=require("olives")["Event.plugin"],flickrContent=require("../services/flickrContent"),Store=require("emily").Store,Observable=require("emily").Observable,Tools=require("emily").Tools,helpers=require("../adapters/helpers");function CollectionsConstructor($collections){var viewModel=new Store($collections.map(function(collection){collection.url=flickrContent.createUrl(collection,"z");return collection})),bind=new Bind(viewModel,Tools.mixin({getId:function(item){var index=viewModel.proxy("indexOf",item)+1+"";this.innerHTML=index.length==1?"0"+index:index}},helpers)),eventPlugin=new Event(this);this.plugins.addAll({bind:bind,event:eventPlugin});this.drillin=function drillin(event,dom){var collection=viewModel.get(bind.getItemIndex(dom));this.notify("drillin",collection.collection_id)}}module.exports=function CollectionsFactory($collections){Tools.mixin(new OObject,CollectionsConstructor.prototype);Tools.mixin(new Observable,CollectionsConstructor.prototype);var collections=new CollectionsConstructor($collections);return collections}},{"../adapters/helpers":3,"../services/flickrContent":6,emily:19,olives:26}],9:[function(require,module,exports){var OObject=require("olives").OObject,Bind=require("olives")["Bind.plugin"],Events=require("olives")["Event.plugin"],Observable=require("emily").Observable,Tools=require("emily").Tools;function NavigationConstructor(){var events=new Events(this);this.plugins.addAll({events:events});this.back=function back(){this.notify("back")};this.home=function home(){this.notify("home")}}module.exports=function NavigationFactory(){Tools.mixin(new OObject,NavigationConstructor.prototype);Tools.mixin(new Observable,NavigationConstructor.prototype);return new NavigationConstructor}},{emily:19,olives:26}],10:[function(require,module,exports){var OObject=require("olives").OObject,Bind=require("olives")["Bind.plugin"],Event=require("olives")["Event.plugin"],flickrContent=require("../services/flickrContent"),Store=require("emily").Store,Observable=require("emily").Observable,Tools=require("emily").Tools,helpers=require("../adapters/helpers");function PhotosetsConstructor(){var viewModel=new Store,bind=new Bind(viewModel,helpers),eventPlugin=new Event(this);this.plugins.addAll({bind:bind,event:eventPlugin});this.drillin=function drillin(event,dom){var photoset=viewModel.get(bind.getItemIndex(dom));this.notify("drillin",photoset.photoset_id)};this.setPhotosets=function setPhotosets(photosets){viewModel.reset(photosets.map(function(photoset){photoset.url=flickrContent.createUrl(photoset,"z");return photoset}))}}module.exports=function PhotosetsFactory(){Tools.mixin(new OObject,PhotosetsConstructor.prototype);Tools.mixin(new Observable,PhotosetsConstructor.prototype);return new PhotosetsConstructor}},{"../adapters/helpers":3,"../services/flickrContent":6,emily:19,olives:26}],11:[function(require,module,exports){var OObject=require("olives").OObject,Bind=require("olives")["Bind.plugin"],Events=require("olives")["Event.plugin"],flickrContent=require("../services/flickrContent"),Store=require("emily").Store,Tools=require("emily").Tools,helpers=require("../adapters/helpers");function SlideshowConstructor(){var slideShowModel=new Store({}),photosetModel=new Store([]),slideShow=new Bind(slideShowModel,helpers),events=new Events(this);this.plugins.addAll({slideshow:slideShow,events:events});slideShowModel.watchValue("main",function(photo){var index=photosetModel.proxy("indexOf",photo),previous=photosetModel.get(index-1),next=photosetModel.get(index+1);slideShowModel.set("hasPrevious",!!previous);if(previous){slideShowModel.set("previous",previous.url)}slideShowModel.set("hasNext",!!next);if(next){slideShowModel.set("next",next.url)}slideShowModel.set("currentMain",index);slideShowModel.set("current",photo.url)});this.next=function next(){var newMainPhoto=photosetModel.get(slideShowModel.get("currentMain")+1);if(newMainPhoto){slideShowModel.set("main",newMainPhoto)}};this.previous=function previous(){var newMainPhoto=photosetModel.get(slideShowModel.get("currentMain")-1);if(newMainPhoto){slideShowModel.set("main",newMainPhoto)}};this.setPhotoset=function setPhotoset(photoset){if(!photoset){return false}photosetModel.reset(photoset.map(function(photo){photo.url=flickrContent.createUrl(photo,"z");return photo}))};this.setPhotoIndex=function setPhotoIndex(photoIndex){var photo=photosetModel.get(photoIndex);if(!photo){return false}slideShowModel.set("main",photo)}}module.exports=function SlideshowFactory(){Tools.mixin(new OObject,SlideshowConstructor.prototype);return new SlideshowConstructor}},{"../adapters/helpers":3,"../services/flickrContent":6,emily:19,olives:26}],12:[function(require,module,exports){"use strict";var Tools=require("./Tools");module.exports=function ObservableConstructor(){var _topics={};this.watch=function watch(topic,callback,scope){if(typeof callback=="function"){var observers=_topics[topic]=_topics[topic]||[],observer=[callback,scope];observers.push(observer);return[topic,observers.indexOf(observer)]}else{return false}};this.once=function once(topic,callback,scope){var handle=this.watch(topic,function(){callback.apply(scope,arguments);this.unwatch(handle)},this);return handle};this.unwatch=function unwatch(handle){var topic=handle[0],idx=handle[1];if(_topics[topic]&&_topics[topic][idx]){delete _topics[topic][idx];if(!_topics[topic].some(function(value){return!!value})){delete _topics[topic]}return true}else{return false}};this.notify=function notify(topic){var observers=_topics[topic],args=Tools.toArray(arguments).slice(1);if(observers){Tools.loop(observers,function(value){try{if(value){value[0].apply(value[1]||null,args)}}catch(err){}});return true}else{return false}};this.hasObserver=function hasObserver(handle){return!!(handle&&_topics[handle[0]]&&_topics[handle[0]][handle[1]])};this.hasTopic=function hasTopic(topic){return!!_topics[topic]};this.unwatchAll=function unwatchAll(topic){if(_topics[topic]){delete _topics[topic]}else{_topics={}}return true}}},{"./Tools":17}],13:[function(require,module,exports){"use strict";var Observable=require("./Observable"),StateMachine=require("./StateMachine");module.exports=function PromiseConstructor(){var _value=null,_reason=null,_observable=new Observable,_states={Pending:[["fulfill",function onFulfill(value){_value=value;_observable.notify("fulfill",value)},"Fulfilled"],["reject",function onReject(reason){_reason=reason;_observable.notify("reject",reason)},"Rejected"],["toFulfill",function toFulfill(resolver){_observable.watch("fulfill",resolver)}],["toReject",function toReject(resolver){_observable.watch("reject",resolver)}]],Fulfilled:[["toFulfill",function toFulfill(resolver){setTimeout(function(){resolver(_value)},0)}]],Rejected:[["toReject",function toReject(resolver){setTimeout(function(){resolver(_reason)},0)}]]},_stateMachine=new StateMachine("Pending",_states);this.fulfill=function fulfill(value){_stateMachine.event("fulfill",value);return this};this.reject=function reject(reason){_stateMachine.event("reject",reason);return this};this.then=function then(){var promise=new PromiseConstructor;if(arguments[0]instanceof Function){if(arguments[1]instanceof Function){_stateMachine.event("toFulfill",this.makeResolver(promise,arguments[0]))}else{_stateMachine.event("toFulfill",this.makeResolver(promise,arguments[0],arguments[1]))}}else{_stateMachine.event("toFulfill",this.makeResolver(promise,function(){promise.fulfill(_value)}))}if(arguments[1]instanceof Function){_stateMachine.event("toReject",this.makeResolver(promise,arguments[1],arguments[2]))}if(arguments[2]instanceof Function){_stateMachine.event("toReject",this.makeResolver(promise,arguments[2],arguments[3]))}if(!(arguments[1]instanceof Function)&&!(arguments[2]instanceof Function)){_stateMachine.event("toReject",this.makeResolver(promise,function(){promise.reject(_reason)}))}return promise};this.sync=function sync(syncWith){if(syncWith instanceof Object&&syncWith.then){var onFulfilled=function onFulfilled(value){this.fulfill(value)},onRejected=function onRejected(reason){this.reject(reason)};syncWith.then(onFulfilled.bind(this),onRejected.bind(this));return true}else{return false}};this.makeResolver=function makeResolver(promise,func,scope){return function resolver(value){var returnedPromise;try{returnedPromise=func.call(scope,value);if(!promise.sync(returnedPromise)){promise.fulfill(returnedPromise)}}catch(err){promise.reject(err)}}};this.getReason=function getReason(){return _reason};this.getValue=function getValue(){return _value};this.getObservable=function getObservable(){return _observable};this.getStateMachine=function getStateMachine(){return _stateMachine};this.getStates=function getStates(){return _states}}},{"./Observable":12,"./StateMachine":15}],14:[function(require,module,exports){"use strict";var Observable=require("./Observable"),Store=require("./Store"),Tools=require("./Tools");module.exports=function RouterConstructor(){var _routes=new Observable,_events=new Observable,_history=new Store([]),_currentPos=-1,_maxHistory=10;this.getRoutesObservable=function getRoutesObservable(){return _routes};this.getEventsObservable=function getEventsObservable(){return _events};this.setMaxHistory=function setMaxHistory(maxHistory){if(maxHistory>=0){_maxHistory=maxHistory;return true}else{return false}};this.getMaxHistory=function getMaxHistory(){return _maxHistory};this.set=function set(){return _routes.watch.apply(_routes,arguments)};this.unset=function unset(handle){return _routes.unwatch(handle)};this.navigate=function get(route,params){if(this.load.apply(this,arguments)){_history.proxy("splice",_currentPos+1,_history.count());_history.proxy("push",Tools.toArray(arguments));this.ensureMaxHistory(_history);_currentPos=_history.count()-1;return true}else{return false}};this.ensureMaxHistory=function ensureMaxHistory(history){var count=history.count(),max=this.getMaxHistory(),excess=count-max;if(excess>0){history.proxy("splice",0,excess)}};this.load=function load(){var copy=Tools.toArray(arguments);if(_routes.notify.apply(_routes,copy)){copy.unshift("route");_events.notify.apply(_events,copy);return true}else{return false}};this.watch=function watch(func,scope){return _events.watch("route",func,scope)};this.unwatch=function unwatch(handle){return _events.unwatch(handle)};this.getHistoryStore=function getHistoryStore(){return _history};this.getHistoryCount=function getHistoryCount(){return _history.count()};this.clearHistory=function clearHistory(){_history.reset([])};this.go=function go(nb){var history=_history.get(_currentPos+nb);if(history){_currentPos+=nb;this.load.apply(this,history);return true}else{return false}};this.back=function back(){return this.go(-1)};this.forward=function forward(){return this.go(1)}}},{"./Observable":12,"./Store":16,"./Tools":17}],15:[function(require,module,exports){"use strict";var Tools=require("./Tools");module.exports=function StateMachineConstructor($initState,$diagram){var _states={},_currentState="";this.init=function init(name){if(_states[name]){_currentState=name;return true}else{return false}};this.add=function add(name){if(!_states[name]){var transition=_states[name]=new Transition;return transition}else{return _states[name]}};this.get=function get(name){return _states[name]};this.getCurrent=function getCurrent(){return _currentState};this.has=function has(state){return _states.hasOwnProperty(state)};this.advance=function advance(state){if(this.has(state)){_currentState=state;return true}else{return false}};this.event=function event(name){var nextState;nextState=_states[_currentState].event.apply(_states[_currentState].event,Tools.toArray(arguments));if(nextState===false){return false}else{if(nextState){_states[_currentState].event("exit");_currentState=nextState;_states[_currentState].event("entry")}return true}};Tools.loop($diagram,function(transition,state){var myState=this.add(state);transition.forEach(function(params){myState.add.apply(null,params)})},this);this.init($initState)};function Transition(){var _transitions={};this.add=function add(event,action,scope,next){var arr=[];if(_transitions[event]){return false}if(typeof event=="string"&&typeof action=="function"){arr[0]=action;if(typeof scope=="object"){arr[1]=scope}if(typeof scope=="string"){arr[2]=scope}if(typeof next=="string"){arr[2]=next}_transitions[event]=arr;return true}return false};this.has=function has(event){return!!_transitions[event]};this.get=function get(event){return _transitions[event]||false};this.event=function event(newEvent){var _transition=_transitions[newEvent];if(_transition){_transition[0].apply(_transition[1],Tools.toArray(arguments).slice(1));return _transition[2]}else{return false}}}},{"./Tools":17}],16:[function(require,module,exports){"use strict";var Observable=require("./Observable"),Tools=require("./Tools");module.exports=function StoreConstructor($data){var _data=Tools.clone($data)||{},_storeObservable=new Observable,_valueObservable=new Observable,_computed=[],_notifyDiffs=function _notifyDiffs(previousData){var diffs=Tools.objectsDiffs(previousData,_data);["updated","deleted","added"].forEach(function(value){diffs[value].forEach(function(dataIndex){_storeObservable.notify(value,dataIndex,_data[dataIndex]);_valueObservable.notify(dataIndex,_data[dataIndex],value)})})};this.getNbItems=function(){return _data instanceof Array?_data.length:Tools.count(_data)};this.count=this.getNbItems;this.get=function get(name){return _data[name]};this.has=function has(name){return _data.hasOwnProperty(name)};this.set=function set(name,value){var hasPrevious,previousValue,action;if(typeof name!="undefined"){hasPrevious=this.has(name);previousValue=this.get(name);_data[name]=value;action=hasPrevious?"updated":"added";_storeObservable.notify(action,name,_data[name],previousValue);_valueObservable.notify(name,_data[name],action,previousValue);return true}else{return false}};this.update=function update(name,property,value){var item;if(this.has(name)){item=this.get(name);Tools.setNestedProperty(item,property,value);_storeObservable.notify("updated",property,value);_valueObservable.notify(name,item,"updated");return true}else{return false}};this.del=function del(name){if(this.has(name)){if(!this.alter("splice",name,1)){delete _data[name];_storeObservable.notify("deleted",name);_valueObservable.notify(name,_data[name],"deleted")}return true}else{return false}};this.delAll=function delAll(indexes){if(indexes instanceof Array){indexes.sort(Tools.compareNumbers).reverse().forEach(this.del,this);return true}else{return false}};this.alter=function alter(func){var apply,previousData;if(_data[func]){previousData=Tools.clone(_data);apply=this.proxy.apply(this,arguments);_notifyDiffs(previousData);_storeObservable.notify("altered",_data,previousData);return apply}else{return false}};this.proxy=function proxy(func){if(_data[func]){return _data[func].apply(_data,Array.prototype.slice.call(arguments,1))}else{return false}};this.watch=function watch(name,func,scope){return _storeObservable.watch(name,func,scope)};this.unwatch=function unwatch(handle){return _storeObservable.unwatch(handle)};this.getStoreObservable=function getStoreObservable(){return _storeObservable};this.watchValue=function watchValue(name,func,scope){return _valueObservable.watch(name,func,scope)};this.unwatchValue=function unwatchValue(handler){return _valueObservable.unwatch(handler)};this.getValueObservable=function getValueObservable(){return _valueObservable};this.loop=function loop(func,scope){Tools.loop(_data,func,scope)};this.reset=function reset(data){if(data instanceof Object){var previousData=Tools.clone(_data);_data=Tools.clone(data)||{};_notifyDiffs(previousData);_storeObservable.notify("resetted",_data,previousData);return true}else{return false}};this.compute=function compute(name,computeFrom,callback,scope){var args=[];if(typeof name=="string"&&typeof computeFrom=="object"&&typeof callback=="function"&&!this.isCompute(name)){_computed[name]=[];Tools.loop(computeFrom,function(property){_computed[name].push(this.watchValue(property,function(){this.set(name,callback.call(scope))},this))},this);this.set(name,callback.call(scope));return true}else{return false}};this.removeCompute=function removeCompute(name){if(this.isCompute(name)){Tools.loop(_computed[name],function(handle){this.unwatchValue(handle)},this);this.del(name);return true}else{return false}};this.isCompute=function isCompute(name){return!!_computed[name]};this.toJSON=function toJSON(){return JSON.stringify(_data)};this.dump=function dump(){return _data}}},{"./Observable":12,"./Tools":17}],17:[function(require,module,exports){"use strict";function _getClosest(item,array,getDiff){var closest,diff;if(!array){return}array.forEach(function(comparedItem,comparedItemIndex){var thisDiff=getDiff(comparedItem,item);if(thisDiff>=0&&(typeof diff=="undefined"||thisDiff<diff)){diff=thisDiff;closest=comparedItemIndex}});return closest}module.exports={getGlobal:function getGlobal(){return Function("return this")()},mixin:function mixin(source,destination,dontOverride){this.loop(source,function(value,idx){if(!destination[idx]||!dontOverride){destination[idx]=source[idx]}});return destination},count:function count(object){var nbItems=0;this.loop(object,function(){nbItems++});return nbItems},compareObjects:function compareObjects(object1,object2){var getOwnProperties=function(object){return Object.getOwnPropertyNames(object).sort().join("")};return getOwnProperties(object1)==getOwnProperties(object2)},compareNumbers:function compareNumbers(number1,number2){if(number1>number2){return 1}else if(number1<number2){return-1}else{return 0}},toArray:function toArray(array){return[].slice.call(array)},loop:function loop(iterated,callback,scope){var i,length;if(iterated instanceof Object&&callback instanceof Function){if(iterated instanceof Array){for(i=0;i<iterated.length;i++){callback.call(scope,iterated[i],i,iterated)}}else{for(i in iterated){if(iterated.hasOwnProperty(i)){callback.call(scope,iterated[i],i,iterated)}}}return true}else{return false}},objectsDiffs:function objectsDiffs(before,after){if(before instanceof Object&&after instanceof Object){var unchanged=[],updated=[],deleted=[],added=[];this.loop(after,function(value,idx){if(typeof before[idx]=="undefined"){added.push(idx)}else if(value!==before[idx]){updated.push(idx)}else if(value===before[idx]){unchanged.push(idx)}});this.loop(before,function(value,idx){if(typeof after[idx]=="undefined"){deleted.push(idx)}});return{updated:updated,unchanged:unchanged,added:added,deleted:deleted}}else{return false}},jsonify:function jsonify(object){if(object instanceof Object){return JSON.parse(JSON.stringify(object))}else{return false}},clone:function clone(object){if(object instanceof Array){return object.slice(0)}else if(typeof object=="object"&&object!==null&&!(object instanceof RegExp)){return this.mixin(object,{})}else{return false}},getNestedProperty:function getNestedProperty(object,property){if(object&&object instanceof Object){if(typeof property=="string"&&property!==""){var split=property.split(".");return split.reduce(function(obj,prop){return obj&&obj[prop]},object)}else if(typeof property=="number"){return object[property]}else{return object}}else{return object}},setNestedProperty:function setNestedProperty(object,property,value){if(object&&object instanceof Object){if(typeof property=="string"&&property!==""){var split=property.split(".");return split.reduce(function(obj,prop,idx){obj[prop]=obj[prop]||{};if(split.length==idx+1){obj[prop]=value}return obj[prop]},object)}else if(typeof property=="number"){object[property]=value;return object[property]}else{return object}}else{return object}},closest:function closest(item,array){return _getClosest(item,array,function(comparedItem,item){return Math.abs(comparedItem-item)})},closestGreater:function closestGreater(item,array){return _getClosest(item,array,function(comparedItem,item){return comparedItem-item})},closestLower:function closestLower(item,array){return _getClosest(item,array,function(comparedItem,item){return item-comparedItem})}}},{}],18:[function(require,module,exports){"use strict";module.exports=function TransportConstructor($reqHandlers){var _reqHandlers=null;this.setReqHandlers=function setReqHandlers(reqHandlers){if(reqHandlers instanceof Object){_reqHandlers=reqHandlers;return true}else{return false}};this.getReqHandlers=function getReqHandlers(){return _reqHandlers};this.request=function request(reqHandler,data,callback,scope){if(_reqHandlers.has(reqHandler)&&typeof data!="undefined"){_reqHandlers.get(reqHandler)(data,function(){if(callback){callback.apply(scope,arguments)}});return true}else{return false}};this.listen=function listen(reqHandler,data,callback,scope){if(_reqHandlers.has(reqHandler)&&typeof data!="undefined"&&typeof callback=="function"){var func=function(){callback.apply(scope,arguments)},abort;abort=_reqHandlers.get(reqHandler)(data,func,func);return function(){if(typeof abort=="function"){abort()}else if(typeof abort=="object"&&typeof abort.func=="function"){abort.func.call(abort.scope)}}}else{return false}};this.setReqHandlers($reqHandlers)}},{}],19:[function(require,module,exports){module.exports={Observable:require("./Observable"),Promise:require("./Promise"),Router:require("./Router"),StateMachine:require("./StateMachine"),Store:require("./Store"),Tools:require("./Tools"),Transport:require("./Transport")}
},{"./Observable":12,"./Promise":13,"./Router":14,"./StateMachine":15,"./Store":16,"./Tools":17,"./Transport":18}],20:[function(require,module,exports){"use strict";var DEFAULT_URL="http://ycpi.api.flickr.com/services/rest/";var DEFAULT_CALLBACKNAME="jsoncallback";var Jsonp=require("jsonp-utils");module.exports=new Jsonp({url:DEFAULT_URL,callbackName:DEFAULT_CALLBACKNAME})},{"jsonp-utils":21}],21:[function(require,module,exports){"use strict";var scriptUtils=require("script-utils"),uuidGenerator=require("uuid"),querystring=require("querystring"),vow=require("vow");module.exports=function Jsonp(params){params=params||{};var _timeout=params.timeout||15e3,_callbackName=params.callbackName||"callback",_url=params.url||"",_timers={};this.getTimeout=function getTimeout(){return _timeout};this.setTimeout=function setTimeout(timeout){_timeout=timeout};this.setCallbackName=function setCallbackName(callbackName){_callbackName=callbackName};this.getCallbackName=function getCallbackName(){return _callbackName};this.setUrl=function setUrl(url){_url=url};this.getUrl=function getUrl(){return _url};this.get=function get(options,callback,scope){var uuid=getUniqueId(),deferred=vow.defer(),serializedOptions=serializeOptions(addCallbackName(options,uuid)),script=scriptUtils.create(prepareUrl(_url,serializedOptions),function(){scriptUtils.remove(script)});createUniqueCallback(uuid,callback,scope,deferred);scriptUtils.append(script);startTimer(uuid,script,callback,scope,deferred);return deferred.promise()};function startTimer(uuid,script,callback,scope,deferred){_timers[uuid]=setTimeout(function(){var error=new Error("Timeout after "+_timeout+" ms");callback&&callback.call(scope,error);deferred.reject(error);delete window[uuid];scriptUtils.remove(script)},_timeout)}function clearTimer(uuid){clearTimeout(_timers[uuid])}function getUniqueId(){return"_jsonp_"+uuidGenerator.v4().replace(/-/g,"")}function addCallbackName(options,uuid){options[_callbackName]=uuid;return options}function serializeOptions(options){return querystring.stringify(options)}function prepareUrl(url,options){return url+"?"+options}function createUniqueCallback(uuid,callback,scope,deferred){window[uuid]=function(){callback&&callback.apply(scope,[null].concat([].slice.call(arguments)));deferred.resolve.apply(deferred,arguments);clearTimer(uuid);delete window[uuid]}}}},{querystring:42,"script-utils":22,uuid:24,vow:25}],22:[function(require,module,exports){"use strict";module.exports={append:function append(script){document.querySelector("head").appendChild(script)},remove:function remove(script){script.parentElement.removeChild(script)},create:function create(src,callback,scope){var script=document.createElement("script");script.src=src;script.addEventListener("load",function(){callback.apply(scope,arguments)},true);return script}}},{}],23:[function(require,module,exports){var global=typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng},{}],24:[function(require,module,exports){var Buffer=require("__browserify_Buffer");var _rng=require("./rng");var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;module.exports=uuid},{"./rng":23,__browserify_Buffer:38}],25:[function(require,module,exports){var process=require("__browserify_process");(function(global){var Deferred=function(){this._promise=new Promise};Deferred.prototype={promise:function(){return this._promise},resolve:function(value){this._promise.isResolved()||this._promise._resolve(value)},reject:function(reason){this._promise.isResolved()||this._promise._reject(reason)},notify:function(value){this._promise.isResolved()||this._promise._notify(value)}};var PROMISE_STATUS={PENDING:0,FULFILLED:1,REJECTED:-1};var Promise=function(resolver){this._value=undef;this._status=PROMISE_STATUS.PENDING;this._fulfilledCallbacks=[];this._rejectedCallbacks=[];this._progressCallbacks=[];if(resolver){var _this=this,resolverFnLen=resolver.length;resolver(function(val){_this.isResolved()||_this._resolve(val)},resolverFnLen>1?function(reason){_this.isResolved()||_this._reject(reason)}:undef,resolverFnLen>2?function(val){_this.isResolved()||_this._notify(val)}:undef)}};Promise.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==PROMISE_STATUS.PENDING},isFulfilled:function(){return this._status===PROMISE_STATUS.FULFILLED},isRejected:function(){return this._status===PROMISE_STATUS.REJECTED},then:function(onFulfilled,onRejected,onProgress,ctx){var defer=new Deferred;this._addCallbacks(defer,onFulfilled,onRejected,onProgress,ctx);return defer.promise()},"catch":function(onRejected,ctx){return this.then(undef,onRejected,ctx)},fail:function(onRejected,ctx){return this.then(undef,onRejected,ctx)},always:function(onResolved,ctx){var _this=this,cb=function(){return onResolved.call(this,_this)};return this.then(cb,cb,ctx)},progress:function(onProgress,ctx){return this.then(undef,undef,onProgress,ctx)},spread:function(onFulfilled,onRejected,ctx){return this.then(function(val){return onFulfilled.apply(this,val)},onRejected,ctx)},done:function(onFulfilled,onRejected,onProgress,ctx){this.then(onFulfilled,onRejected,onProgress,ctx).fail(throwException)},delay:function(delay){var timer,promise=this.then(function(val){var defer=new Deferred;timer=setTimeout(function(){defer.resolve(val)},delay);return defer.promise()});promise.always(function(){clearTimeout(timer)});return promise},timeout:function(timeout){var defer=new Deferred,timer=setTimeout(function(){defer.reject(Error("timed out"))},timeout);this.then(function(val){defer.resolve(val)},function(reason){defer.reject(reason)});defer.promise().always(function(){clearTimeout(timer)});return defer.promise()},_resolve:function(val){if(this._status!==PROMISE_STATUS.PENDING){return}if(val===this){this._reject(TypeError("Can't resolve promise with itself"));return}if(isVowPromise(val)){val.then(this._resolve,this._reject,this._notify,this);return}if(isObject(val)||isFunction(val)){var then;try{then=val.then}catch(e){this._reject(e);return}if(isFunction(then)){var _this=this,isResolved=false;try{then.call(val,function(val){if(isResolved){return}isResolved=true;_this._resolve(val)},function(err){if(isResolved){return}isResolved=true;_this._reject(err)},function(val){_this._notify(val)})}catch(e){isResolved||this._reject(e)}return}}this._fulfill(val)},_fulfill:function(val){if(this._status!==PROMISE_STATUS.PENDING){return}this._status=PROMISE_STATUS.FULFILLED;this._value=val;this._callCallbacks(this._fulfilledCallbacks,val);this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=undef},_reject:function(reason){if(this._status!==PROMISE_STATUS.PENDING){return}this._status=PROMISE_STATUS.REJECTED;this._value=reason;this._callCallbacks(this._rejectedCallbacks,reason);this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=undef},_notify:function(val){this._callCallbacks(this._progressCallbacks,val)},_addCallbacks:function(defer,onFulfilled,onRejected,onProgress,ctx){if(onRejected&&!isFunction(onRejected)){ctx=onRejected;onRejected=undef}else if(onProgress&&!isFunction(onProgress)){ctx=onProgress;onProgress=undef}var cb;if(!this.isRejected()){cb={defer:defer,fn:isFunction(onFulfilled)?onFulfilled:undef,ctx:ctx};this.isFulfilled()?this._callCallbacks([cb],this._value):this._fulfilledCallbacks.push(cb)}if(!this.isFulfilled()){cb={defer:defer,fn:onRejected,ctx:ctx};this.isRejected()?this._callCallbacks([cb],this._value):this._rejectedCallbacks.push(cb)}if(this._status===PROMISE_STATUS.PENDING){this._progressCallbacks.push({defer:defer,fn:onProgress,ctx:ctx})}},_callCallbacks:function(callbacks,arg){var len=callbacks.length;if(!len){return}var isResolved=this.isResolved(),isFulfilled=this.isFulfilled();nextTick(function(){var i=0,cb,defer,fn;while(i<len){cb=callbacks[i++];defer=cb.defer;fn=cb.fn;if(fn){var ctx=cb.ctx,res;try{res=ctx?fn.call(ctx,arg):fn(arg)}catch(e){defer.reject(e);continue}isResolved?defer.resolve(res):defer.notify(res)}else{isResolved?isFulfilled?defer.resolve(arg):defer.reject(arg):defer.notify(arg)}}})}};var staticMethods={cast:function(value){return vow.cast(value)},all:function(iterable){return vow.all(iterable)},race:function(iterable){return vow.anyResolved(iterable)},resolve:function(value){return vow.resolve(value)},reject:function(reason){return vow.reject(reason)}};for(var prop in staticMethods){staticMethods.hasOwnProperty(prop)&&(Promise[prop]=staticMethods[prop])}var vow={Deferred:Deferred,Promise:Promise,defer:function(){return new Deferred},when:function(value,onFulfilled,onRejected,onProgress,ctx){return vow.cast(value).then(onFulfilled,onRejected,onProgress,ctx)},fail:function(value,onRejected,ctx){return vow.when(value,undef,onRejected,ctx)},always:function(value,onResolved,ctx){return vow.when(value).always(onResolved,ctx)},progress:function(value,onProgress,ctx){return vow.when(value).progress(onProgress,ctx)},spread:function(value,onFulfilled,onRejected,ctx){return vow.when(value).spread(onFulfilled,onRejected,ctx)},done:function(value,onFulfilled,onRejected,onProgress,ctx){vow.when(value).done(onFulfilled,onRejected,onProgress,ctx)},isPromise:function(value){return isObject(value)&&isFunction(value.then)},cast:function(value){return vow.isPromise(value)?value:vow.resolve(value)},valueOf:function(value){return isVowPromise(value)?value.valueOf():value},isFulfilled:function(value){return isVowPromise(value)?value.isFulfilled():true},isRejected:function(value){return isVowPromise(value)?value.isRejected():false},isResolved:function(value){return isVowPromise(value)?value.isResolved():true},resolve:function(value){var res=vow.defer();res.resolve(value);return res.promise()},fulfill:function(value){return vow.when(value,null,function(reason){return reason})},reject:function(reason){return vow.when(reason,function(val){throw val})},invoke:function(fn,args){try{return vow.resolve(fn.apply(global,slice.call(arguments,1)))}catch(e){return vow.reject(e)}},all:function(iterable){var defer=new Deferred,isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),len=keys.length,res=isPromisesArray?[]:{};if(!len){defer.resolve(res);return defer.promise()}var i=len,onFulfilled=function(){if(!--i){var j=0;while(j<len){res[keys[j]]=vow.valueOf(iterable[keys[j++]])}defer.resolve(res)}},onRejected=function(reason){defer.reject(reason)};vow._forEach(iterable,onFulfilled,onRejected,keys);return defer.promise()},allResolved:function(iterable){var defer=new Deferred,isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),i=keys.length,res=isPromisesArray?[]:{};if(!i){defer.resolve(res);return defer.promise()}var onProgress=function(){--i||defer.resolve(iterable)};vow._forEach(iterable,onProgress,onProgress,keys);return defer.promise()},allPatiently:function(iterable){return vow.allResolved(iterable).then(function(){var isPromisesArray=isArray(iterable),keys=isPromisesArray?getArrayKeys(iterable):getObjectKeys(iterable),rejectedPromises,fulfilledPromises,len=keys.length,i=0,key,promise;if(!len){return isPromisesArray?[]:{}}while(i<len){key=keys[i++];promise=iterable[key];if(vow.isRejected(promise)){rejectedPromises||(rejectedPromises=isPromisesArray?[]:{});isPromisesArray?rejectedPromises.push(promise.valueOf()):rejectedPromises[key]=promise.valueOf()}else if(!rejectedPromises){(fulfilledPromises||(fulfilledPromises=isPromisesArray?[]:{}))[key]=vow.valueOf(promise)}}if(rejectedPromises){throw rejectedPromises}return fulfilledPromises})},any:function(iterable){var defer=new Deferred,len=iterable.length;if(!len){defer.reject(Error());return defer.promise()}var i=0,reason,onFulfilled=function(val){defer.resolve(val)},onRejected=function(e){i||(reason=e);++i===len&&defer.reject(reason)};vow._forEach(iterable,onFulfilled,onRejected);return defer.promise()},anyResolved:function(iterable){var defer=new Deferred,len=iterable.length;if(!len){defer.reject(Error());return defer.promise()}vow._forEach(iterable,function(val){defer.resolve(val)},function(reason){defer.reject(reason)});return defer.promise()},delay:function(value,delay){return vow.resolve(value).delay(delay)},timeout:function(value,timeout){return vow.resolve(value).timeout(timeout)},_forEach:function(promises,onFulfilled,onRejected,keys){var len=keys?keys.length:promises.length,i=0;while(i<len){vow.when(promises[keys?keys[i]:i],onFulfilled,onRejected);++i}}};var undef,nextTick=function(){var fns=[],enqueueFn=function(fn){return fns.push(fn)===1},callFns=function(){var fnsToCall=fns,i=0,len=fns.length;fns=[];while(i<len){fnsToCall[i++]()}};if(typeof setImmediate==="function"){return function(fn){enqueueFn(fn)&&setImmediate(callFns)}}if(typeof process==="object"&&process.nextTick){return function(fn){enqueueFn(fn)&&process.nextTick(callFns)}}if(global.postMessage){var isPostMessageAsync=true;if(global.attachEvent){var checkAsync=function(){isPostMessageAsync=false};global.attachEvent("onmessage",checkAsync);global.postMessage("__checkAsync","*");global.detachEvent("onmessage",checkAsync)}if(isPostMessageAsync){var msg="__promise"+ +new Date,onMessage=function(e){if(e.data===msg){e.stopPropagation&&e.stopPropagation();callFns()}};global.addEventListener?global.addEventListener("message",onMessage,true):global.attachEvent("onmessage",onMessage);return function(fn){enqueueFn(fn)&&global.postMessage(msg,"*")}}}var doc=global.document;if("onreadystatechange"in doc.createElement("script")){var createScript=function(){var script=doc.createElement("script");script.onreadystatechange=function(){script.parentNode.removeChild(script);script=script.onreadystatechange=null;callFns()};(doc.documentElement||doc.body).appendChild(script)};return function(fn){enqueueFn(fn)&&createScript()}}return function(fn){enqueueFn(fn)&&setTimeout(callFns,0)}}(),throwException=function(e){nextTick(function(){throw e})},isFunction=function(obj){return typeof obj==="function"},isObject=function(obj){return obj!==null&&typeof obj==="object"},isVowPromise=function(obj){return obj instanceof Promise},slice=Array.prototype.slice,toStr=Object.prototype.toString,isArray=Array.isArray||function(obj){return toStr.call(obj)==="[object Array]"},getArrayKeys=function(arr){var res=[],i=0,len=arr.length;while(i<len){res.push(i++)}return res},getObjectKeys=Object.keys||function(obj){var res=[];for(var i in obj){obj.hasOwnProperty(i)&&res.push(i)}return res};var defineAsGlobal=true;if(typeof exports==="object"){module.exports=vow;defineAsGlobal=false}if(typeof modules==="object"){modules.define("vow",function(provide){provide(vow)});defineAsGlobal=false}if(typeof define==="function"){define(function(require,exports,module){module.exports=vow});defineAsGlobal=false}defineAsGlobal&&(global.vow=vow)})(this)},{__browserify_process:39}],26:[function(require,module,exports){var olives=require("./src/olives"),isConnected=false;olives.registerSocketIO=function(io,handlers){if(isConnected){return false}else{io.sockets.on("connection",function(socket){var connectHandler=function(func,handler){socket.on(handler,function(reqData){reqData.data.handshake=socket.handshake;var stop=func(reqData.data,function onEnd(body){socket.emit(reqData.eventId,body)},function onData(chunk){reqData.keepAlive&&socket.emit(reqData.eventId,""+chunk)});if(typeof stop=="function"){socket.on("disconnect-"+reqData.eventId,stop)}})};handlers.loop(connectHandler);handlers.watch("added",connectHandler)});isConnected=true}};module.exports=olives},{"./src/olives":37}],27:[function(require,module,exports){"use strict";var Store=require("emily").Store,Observable=require("emily").Observable,Tools=require("emily").Tools,DomUtils=require("./DomUtils");module.exports=function BindPluginConstructor($model,$bindings){var _model=null,_bindings={},_itemRenderers={},_observers={};this.observers=_observers;function _removeObserversForId(id){if(_observers[id]){_observers[id].forEach(function(handler){_model.unwatchValue(handler)});delete _observers[id]}}this.setModel=function setModel(model){if(model instanceof Store){_model=model;return true}else{return false}};this.getModel=function getModel(){return _model};this.ItemRenderer=function ItemRenderer($plugins,$rootNode){var _node=null,_plugins=null,_rootNode=null,_start=null,_nb=null;this.setRenderer=function setRenderer(node){_node=node;return true};this.getRenderer=function getRenderer(){return _node};this.setRootNode=function setRootNode(rootNode){var renderer;if(DomUtils.isAcceptedType(rootNode)){_rootNode=rootNode;renderer=_rootNode.querySelector("*");this.setRenderer(renderer);if(renderer){_rootNode.removeChild(renderer)}return true}else{return false}};this.getRootNode=function getRootNode(){return _rootNode};this.setPlugins=function setPlugins(plugins){_plugins=plugins;return true};this.getPlugins=function getPlugins(){return _plugins};this.items={};this.setStart=function setStart(start){_start=parseInt(start,10);return _start};this.getStart=function getStart(){return _start};this.setNb=function setNb(nb){_nb=nb=="*"?nb:parseInt(nb,10);return _nb};this.getNb=function getNb(){return _nb};this.addItem=function addItem(id){var node,next;if(typeof id=="number"&&!this.items[id]){next=this.getNextItem(id);node=this.create(id);if(node){if(next){_rootNode.insertBefore(node,next)}else{_rootNode.appendChild(node)}return true}else{return false}}else{return false}};this.getNextItem=function getNextItem(id){var keys=Object.keys(this.items).map(function(string){return Number(string)}),closest=Tools.closestGreater(id,keys),closestId=keys[closest];if(closestId!=id){return this.items[closestId]}else{return}};this.removeItem=function removeItem(id){var item=this.items[id];if(item){_rootNode.removeChild(item);delete this.items[id];_removeObserversForId(id);return true}else{return false}};this.create=function create(id){if(_model.has(id)){var newNode=_node.cloneNode(true),nodes=DomUtils.getNodes(newNode);Tools.toArray(nodes).forEach(function(child){child.setAttribute("data-"+_plugins.name+"_id",id)});this.items[id]=newNode;_plugins.apply(newNode);return newNode}};this.render=function render(){var _tmpNb=_nb=="*"?_model.getNbItems():_nb;var marked=[];if(_nb!==null&&_start!==null){Tools.loop(this.items,function(value,idx){idx=Number(idx);if(idx<_start||idx>=_start+_tmpNb||!_model.has(idx)){marked.push(idx)}},this);marked.sort(Tools.compareNumbers).reverse().forEach(this.removeItem,this);for(var i=_start,l=_tmpNb+_start;i<l;i++){this.addItem(i)}return true}else{return false}};this.setPlugins($plugins);this.setRootNode($rootNode)};this.setItemRenderer=function setItemRenderer(id,itemRenderer){id=id||"default";_itemRenderers[id]=itemRenderer};this.getItemRenderer=function getItemRenderer(id){return _itemRenderers[id]};this.foreach=function foreach(node,idItemRenderer,start,nb){var itemRenderer=new this.ItemRenderer(this.plugins,node);itemRenderer.setStart(start||0);itemRenderer.setNb(nb||"*");itemRenderer.render();_model.watch("added",itemRenderer.render,itemRenderer);_model.watch("deleted",function(idx){itemRenderer.render();_removeObserversForId(idx)},this);this.setItemRenderer(idItemRenderer,itemRenderer)};this.updateStart=function updateStart(id,start){var itemRenderer=this.getItemRenderer(id);if(itemRenderer){itemRenderer.setStart(start);return true}else{return false}};this.updateNb=function updateNb(id,nb){var itemRenderer=this.getItemRenderer(id);if(itemRenderer){itemRenderer.setNb(nb);return true}else{return false}};this.refresh=function refresh(id){var itemRenderer=this.getItemRenderer(id);if(itemRenderer){itemRenderer.render();return true}else{return false}};this.bind=function bind(node,property,name){name=name||"";var id=node.getAttribute("data-"+this.plugins.name+"_id"),split=name.split("."),modelIdx=id||split.shift(),prop=id?name:split.join("."),get=Tools.getNestedProperty(_model.get(modelIdx),prop),extraParam=Tools.toArray(arguments).slice(3);if(get||get===0||get===false){if(!this.execBinding.apply(this,[node,property,get].concat(extraParam))){DomUtils.setAttribute(node,property,get)}}if(!this.hasBinding(property)){node.addEventListener("change",function(event){if(_model.has(modelIdx)){if(prop){_model.update(modelIdx,name,node[property])}else{_model.set(modelIdx,node[property])}}},true)}this.observers[modelIdx]=this.observers[modelIdx]||[];this.observers[modelIdx].push(_model.watchValue(modelIdx,function(value){if(!this.execBinding.apply(this,[node,property,Tools.getNestedProperty(value,prop)].concat(extraParam))){DomUtils.setAttribute(node,property,Tools.getNestedProperty(value,prop))}},this))};this.set=function set(node){if(DomUtils.isAcceptedType(node)&&node.name){_model.set(node.name,node.value);return true}else{return false}};this.getItemIndex=function getElementId(dom){var dataset=DomUtils.getDataset(dom);if(dataset&&typeof dataset[this.plugins.name+"_id"]!="undefined"){return+dataset[this.plugins.name+"_id"]}else{return false}};this.form=function form(DOMform){if(DOMform&&DOMform.nodeName=="FORM"){var that=this;DOMform.addEventListener("submit",function(event){Tools.toArray(DOMform.querySelectorAll("[name]")).forEach(that.set,that);event.preventDefault()},true);return true}else{return false}};this.addBinding=function addBinding(name,binding){if(name&&typeof name=="string"&&typeof binding=="function"){_bindings[name]=binding;return true}else{return false}};this.execBinding=function execBinding(node,name){if(this.hasBinding(name)){_bindings[name].apply(node,Array.prototype.slice.call(arguments,2));return true}else{return false}};this.hasBinding=function hasBinding(name){return _bindings.hasOwnProperty(name)};this.getBinding=function getBinding(name){return _bindings[name]};this.addBindings=function addBindings(list){return Tools.loop(list,function(binding,name){this.addBinding(name,binding)},this)};this.setModel($model);this.addBindings($bindings)}},{"./DomUtils":28,emily:19}],28:[function(require,module,exports){"use strict";var Tools=require("emily").Tools;module.exports={getNodes:function getNodes(dom,query){if(this.isAcceptedType(dom)){if(!dom.parentNode){document.createDocumentFragment().appendChild(dom)}return dom.parentNode.querySelectorAll(query||"*")}else{return false}},getDataset:function getDataset(dom){var i=0,l,dataset={},split,join;if(this.isAcceptedType(dom)){if(dom.hasOwnProperty("dataset")){return dom.dataset}else{for(l=dom.attributes.length;i<l;i++){split=dom.attributes[i].name.split("-");if(split.shift()=="data"){dataset[join=split.join("-")]=dom.getAttribute("data-"+join)}}return dataset}}else{return false}},isAcceptedType:function isAcceptedType(type){if(type instanceof HTMLElement||type instanceof SVGElement){return true}else{return false}},setAttribute:function setAttribute(node,property,value){if(node instanceof HTMLElement){node[property]=value;return true}else if(node instanceof SVGElement){node.setAttribute(property,value);return true}else{return false}},matches:function matches(parent,selector,node){return Tools.toArray(this.getNodes(parent,selector)).indexOf(node)>-1}}},{emily:19}],29:[function(require,module,exports){"use strict";var DomUtils=require("./DomUtils");module.exports=function EventPluginConstructor($parent,$isMobile){var _parent=null,_map={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},_isMobile=!!$isMobile;this.addEventListener=function addEventListener(node,event,callback,useCapture){node.addEventListener(this.map(event),callback,!!useCapture)};this.listen=function listen(node,name,listener,useCapture){this.addEventListener(node,name,function(e){_parent[listener].call(_parent,e,node)},!!useCapture)};this.delegate=function delegate(node,selector,name,listener,useCapture){this.addEventListener(node,name,function(event){if(DomUtils.matches(node,selector,event.target)){_parent[listener].call(_parent,event,node)}},!!useCapture)};this.getParent=function getParent(){return _parent};this.setParent=function setParent(parent){if(parent instanceof Object){_parent=parent;return true}return false};this.map=function map(name){return _isMobile?_map[name]||name:name};this.setMap=function setMap(name,value){if(typeof name=="string"&&typeof value=="string"){_map[name]=value;return true}return false};this.setParent($parent)}},{"./DomUtils":28}],30:[function(require,module,exports){"use strict";var Store=require("emily").Store,Tools=require("emily").Tools;function LocalStoreConstructor(){var _name=null,_localStorage=localStorage,setLocalStorage=function setLocalStorage(){_localStorage.setItem(_name,this.toJSON())};this.setLocalStorage=function setLocalStorage(local$torage){if(local$torage&&local$torage.setItem instanceof Function){_localStorage=local$torage;return true}else{return false}};this.getLocalStorage=function getLocalStorage(){return _localStorage};this.sync=function sync(name){var json;if(typeof name=="string"){_name=name;json=JSON.parse(_localStorage.getItem(name));Tools.loop(json,function(value,idx){if(!this.has(idx)){this.set(idx,value)}},this);setLocalStorage.call(this);this.watch("added",setLocalStorage,this);this.watch("updated",setLocalStorage,this);this.watch("deleted",setLocalStorage,this);return true}else{return false}}}module.exports=function LocalStoreFactory(init){LocalStoreConstructor.prototype=new Store(init);return new LocalStoreConstructor}},{emily:19}],31:[function(require,module,exports){"use strict";var Router=require("emily").Router,Tools=require("emily").Tools;function LocationRouterConstructor(){var _watchHandle,_defaultRoute="",_lastRoute=window.location.hash;function doNavigate(){if(window.location.hash){var parsedHash=this.parse(window.location.hash);this.navigate.apply(this,parsedHash)}else{this.navigate(_defaultRoute)}}this.setDefaultRoute=function setDefaultRoute(defaultRoute){if(defaultRoute&&typeof defaultRoute=="string"){_defaultRoute=defaultRoute;return true}else{return false}};this.getDefaultRoute=function getDefaultRoute(){return _defaultRoute};this.parse=function parse(hash){return hash.split("#").pop().split("/")};this.toUrl=function toUrl(args){return args.join("/")};this.start=function start(defaultRoute){this.setDefaultRoute(defaultRoute);doNavigate.call(this);this.bindOnHashChange();this.bindOnRouteChange()};this.destroy=function destroy(){this.unwatch(_watchHandle);window.removeEventListener("hashchange",this.boundOnHashChange,true)};this.onHashChange=function onHashChange(){if(window.location.hash!=_lastRoute){doNavigate.call(this)}};this.boundOnHashChange=this.onHashChange.bind(this);this.bindOnHashChange=function bindOnHashChange(){window.addEventListener("hashchange",this.boundOnHashChange,true)};this.bindOnRouteChange=function bindOnRouteChange(){_watchHandle=this.watch(this.onRouteChange,this)};this.onRouteChange=function onRouteChange(){window.location.hash=this.toUrl(Tools.toArray(arguments));_lastRoute=window.location.hash};this.getLastRoute=function getLastRoute(){return _lastRoute}}module.exports=function LocationRouterFactory(){LocationRouterConstructor.prototype=new Router;return new LocationRouterConstructor}},{emily:19}],32:[function(require,module,exports){"use strict";var StateMachine=require("emily").StateMachine,Store=require("emily").Store,Plugins=require("./Plugins"),DomUtils=require("./DomUtils"),Tools=require("emily").Tools;module.exports=function OObjectConstructor(otherStore){var render=function render(UI){var baseNode=_currentPlace||document.createElement("div");if(UI.template){if(typeof UI.template=="string"){baseNode.innerHTML=UI.template.trim()}else if(DomUtils.isAcceptedType(UI.template)){baseNode.appendChild(UI.template)}if(baseNode.childNodes.length>1){throw new Error("UI.template should have only one parent node")}else{UI.dom=baseNode.childNodes[0]}UI.plugins.apply(UI.dom)}else{throw new Error("UI.template must be set prior to render")}},place=function place(UI,DOMplace,beforeNode){if(DOMplace){if(beforeNode){DOMplace.insertBefore(UI.dom,beforeNode)}else{DOMplace.appendChild(UI.dom)}_currentPlace=DOMplace}},renderNPlace=function renderNPlace(UI,dom){render(UI);place.apply(null,Tools.toArray(arguments))},_currentPlace=null,_stateMachine=new StateMachine("Init",{Init:[["render",render,this,"Rendered"],["place",renderNPlace,this,"Rendered"]],Rendered:[["place",place,this],["render",render,this]]});this.model=otherStore instanceof Store?otherStore:new Store;this.plugins=new Plugins;this.template=null;this.dom=null;this.place=function place(node,beforeNode){_stateMachine.event("place",this,node,beforeNode)};this.render=function render(){_stateMachine.event("render",this)};this.setTemplateFromDom=function setTemplateFromDom(dom){if(DomUtils.isAcceptedType(dom)){this.template=dom;return true}else{return false}};this.alive=function alive(dom){if(DomUtils.isAcceptedType(dom)){this.setTemplateFromDom(dom);this.place(dom.parentNode,dom.nextElementSibling);return true}else{return false}};this.getCurrentPlace=function(){return _currentPlace}}},{"./DomUtils":28,"./Plugins":34,emily:19}],33:[function(require,module,exports){"use strict";var OObject=require("./OObject"),Tools=require("emily").Tools;module.exports=function PlacePluginConstructor($uis){var _uis={};this.place=function place(node,name){if(_uis[name]instanceof OObject){_uis[name].place(node)}else{throw new Error(name+" is not an OObject UI in place:"+name)}};this.set=function set(name,ui){if(typeof name=="string"&&ui instanceof OObject){_uis[name]=ui;return true}else{return false
}};this.setAll=function setAll(uis){Tools.loop(uis,function(ui,name){this.set(name,ui)},this)};this.get=function get(name){return _uis[name]};this.setAll($uis)}},{"./OObject":32,emily:19}],34:[function(require,module,exports){"use strict";var Tools=require("emily").Tools,DomUtils=require("./DomUtils");module.exports=function PluginsConstructor($plugins){var _plugins={},trim=function trim(string){return string.trim()},applyPlugin=function applyPlugin(node,phrase,plugin){phrase.split(";").forEach(function(couple){var split=couple.split(":"),method=split[0].trim(),params=split[1]?split[1].split(",").map(trim):[];params.unshift(node);if(_plugins[plugin]&&_plugins[plugin][method]){_plugins[plugin][method].apply(_plugins[plugin],params)}})};this.add=function add(name,plugin){var that=this,propertyName="plugins";if(typeof name=="string"&&typeof plugin=="object"&&plugin){_plugins[name]=plugin;plugin[propertyName]={name:name,apply:function apply(){return that.apply.apply(that,arguments)}};return true}else{return false}};this.addAll=function addAll(list){return Tools.loop(list,function(plugin,name){this.add(name,plugin)},this)};this.get=function get(name){return _plugins[name]};this.del=function del(name){return delete _plugins[name]};this.apply=function apply(dom){var nodes;if(DomUtils.isAcceptedType(dom)){nodes=DomUtils.getNodes(dom);Tools.loop(Tools.toArray(nodes),function(node){Tools.loop(DomUtils.getDataset(node),function(phrase,plugin){applyPlugin(node,phrase,plugin)})});return dom}else{return false}};this.addAll($plugins)}},{"./DomUtils":28,emily:19}],35:[function(require,module,exports){"use strict";module.exports=function SocketIOTransportConstructor($socket){var _socket=null;this.setSocket=function setSocket(socket){if(socket&&typeof socket.emit=="function"){_socket=socket;return true}else{return false}};this.getSocket=function getSocket(){return _socket};this.on=function on(event,func){return _socket.on(event,func)};this.once=function once(event,func){return _socket.once(event,func)};this.emit=function emit(event,data,callback){return _socket.emit(event,data,callback)};this.removeListener=function removeListener(event,data,callback){return _socket.removeListener(event,data,callback)};this.request=function request(channel,data,func,scope){if(typeof channel=="string"&&typeof data!="undefined"){var reqData={eventId:Date.now()+Math.floor(Math.random()*1e6),data:data},boundCallback=function(){if(func){func.apply(scope||null,arguments)}};this.once(reqData.eventId,boundCallback);this.emit(channel,reqData);return true}else{return false}};this.listen=function listen(channel,data,func,scope){if(typeof channel=="string"&&typeof data!="undefined"&&typeof func=="function"){var reqData={eventId:Date.now()+Math.floor(Math.random()*1e6),data:data,keepAlive:true},boundCallback=function(){if(func){func.apply(scope||null,arguments)}},that=this;this.on(reqData.eventId,boundCallback);this.emit(channel,reqData);return function stop(){that.emit("disconnect-"+reqData.eventId);that.removeListener(reqData.eventId,boundCallback)}}else{return false}};this.setSocket($socket)}},{}],36:[function(require,module,exports){"use strict";var Tools=require("emily").Tools;module.exports=function StackConstructor($parent){var _parent=document.createDocumentFragment(),_hidePlace=document.createElement("div"),_childNodes=[],_lastTransit=null;this.add=function add(dom){if(!this.has(dom)&&dom instanceof HTMLElement){_parent.appendChild(dom);_childNodes.push(dom);return dom}else{return false}};this.remove=function remove(dom){var index;if(this.has(dom)){index=_childNodes.indexOf(dom);_parent.removeChild(dom);_childNodes.splice(index,1);return dom}else{return false}};this.place=function place(newParentDom){if(newParentDom instanceof HTMLElement){[].slice.call(_parent.childNodes).forEach(function(childDom){if(this.has(childDom)){newParentDom.appendChild(childDom)}},this);return this._setParent(newParentDom)}else{return false}};this.up=function up(dom){if(this.has(dom)){var domPosition=this.getPosition(dom);this.move(dom,domPosition+1);return dom}else{return false}};this.down=function down(dom){if(this.has(dom)){var domPosition=this.getPosition(dom);this.move(dom,domPosition-1);return dom}else{return false}};this.move=function move(dom,position){if(this.has(dom)){var domIndex=_childNodes.indexOf(dom);_childNodes.splice(domIndex,1);var nextElement=getNextElementInDom(position);if(nextElement){_parent.insertBefore(dom,nextElement)}else{_parent.appendChild(dom)}_childNodes.splice(position,0,dom);return dom}else{return false}};function getNextElementInDom(position){if(position>=_childNodes.length){return}var nextElement=_childNodes[position];if(Tools.toArray(_parent.childNodes).indexOf(nextElement)==-1){return getNextElementInDom(position+1)}else{return nextElement}}this.insert=function insert(dom,position){if(!this.has(dom)&&dom instanceof HTMLElement){_childNodes.splice(position,0,dom);_parent.insertBefore(dom,_parent.childNodes[position]);return dom}else{return false}};this.getPosition=function getPosition(dom){return _childNodes.indexOf(dom)};this.count=function count(){return _parent.childNodes.length};this.has=function has(childDom){return this.getPosition(childDom)>=0};this.hide=function hide(dom){if(this.has(dom)){_hidePlace.appendChild(dom);return true}else{return false}};this.show=function show(dom){if(this.has(dom)&&dom.parentNode===_hidePlace){this.move(dom,_childNodes.indexOf(dom));return true}else{return false}};this.hideAll=function hideAll(){_childNodes.forEach(this.hide,this)};this.showAll=function showAll(){_childNodes.forEach(this.show,this)};this.getParent=function _getParent(){return _parent};this._setParent=function _setParent(parent){if(parent instanceof HTMLElement){_parent=parent;return _parent}else{return false}};this.getHidePlace=function getHidePlace(){return _hidePlace};this.setHidePlace=function setHidePlace(hidePlace){if(hidePlace instanceof HTMLElement){_hidePlace=hidePlace;return true}else{return false}};this.getLastTransit=function getLastTransit(){return _lastTransit};this.transit=function transit(dom){if(_lastTransit){this.hide(_lastTransit)}if(this.show(dom)){_lastTransit=dom;return true}else{return false}};this._setParent($parent)}},{emily:19}],37:[function(require,module,exports){"use strict";module.exports={"Bind.plugin":require("./Bind.plugin"),DomUtils:require("./DomUtils"),"Event.plugin":require("./Event.plugin"),LocalStore:require("./LocalStore"),LocationRouter:require("./LocationRouter"),OObject:require("./OObject"),"Place.plugin":require("./Place.plugin"),Plugins:require("./Plugins"),SocketIOTransport:require("./SocketIOTransport"),Stack:require("./Stack")}},{"./Bind.plugin":27,"./DomUtils":28,"./Event.plugin":29,"./LocalStore":30,"./LocationRouter":31,"./OObject":32,"./Place.plugin":33,"./Plugins":34,"./SocketIOTransport":35,"./Stack":36}],38:[function(require,module,exports){require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({PcZj9L:[function(require,module,exports){var TA=require("typedarray");var xDataView=typeof DataView==="undefined"?TA.DataView:DataView;var xArrayBuffer=typeof ArrayBuffer==="undefined"?TA.ArrayBuffer:ArrayBuffer;var xUint8Array=typeof Uint8Array==="undefined"?TA.Uint8Array:Uint8Array;exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var browserSupport;function Buffer(subject,encoding){var type=typeof subject;if(encoding==="base64"&&type==="string"){subject=stringtrim(subject);while(subject.length%4!==0){subject=subject+"="}}var length;if(type==="number")length=coerce(subject);else if(type==="string")length=Buffer.byteLength(subject,encoding);else if(type==="object")length=coerce(subject.length);else throw new Error("First argument needs to be a number, array or string.");var buf=augment(new xUint8Array(length));if(Buffer.isBuffer(subject)){buf.set(subject)}else if(isArrayIsh(subject)){for(var i=0;i<length;i++){if(Buffer.isBuffer(subject))buf[i]=subject.readUInt8(i);else buf[i]=subject[i]}}else if(type==="string"){buf.write(subject,0,encoding)}return buf}Buffer.isEncoding=function(encoding){switch((encoding+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};Buffer.isBuffer=function isBuffer(b){return b&&b._isBuffer};Buffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.")}var i;var buf;if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(i=0;i<list.length;i++){buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}Buffer._charsWritten=i*2;return i}function _utf8Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length)}function _asciiWrite(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length)}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var bytes,pos;return Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length)}function BufferWrite(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return _hexWrite(this,string,offset,length);case"utf8":case"utf-8":return _utf8Write(this,string,offset,length);case"ascii":return _asciiWrite(this,string,offset,length);case"binary":return _binaryWrite(this,string,offset,length);case"base64":return _base64Write(this,string,offset,length);default:throw new Error("Unknown encoding")}}function BufferToString(encoding,start,end){var self=this instanceof ProxyBuffer?this._proxy:this;encoding=String(encoding||"utf8").toLowerCase();start=Number(start)||0;end=end!==undefined?Number(end):end=self.length;if(end===start)return"";switch(encoding){case"hex":return _hexSlice(self,start,end);case"utf8":case"utf-8":return _utf8Slice(self,start,end);case"ascii":return _asciiSlice(self,start,end);case"binary":return _binarySlice(self,start,end);case"base64":return _base64Slice(self,start,end);default:throw new Error("Unknown encoding")}}function BufferToJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this,0)}}function BufferCopy(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;if(end<start)throw new Error("sourceEnd < sourceStart");if(target_start<0||target_start>=target.length)throw new Error("targetStart out of bounds");if(start<0||start>=source.length)throw new Error("sourceStart out of bounds");if(end<0||end>source.length)throw new Error("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;for(var i=0;i<end-start;i++)target[i+target_start]=this[i+start]}function _base64Slice(buf,start,end){var bytes=buf.slice(start,end);return require("base64-js").fromByteArray(bytes)}function _utf8Slice(buf,start,end){var bytes=buf.slice(start,end);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else{tmp+="%"+bytes[i].toString(16)}i++}return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var bytes=buf.slice(start,end);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function BufferSlice(start,end){var len=this.length;start=clamp(start,len,0);end=clamp(end,len,len);return augment(this.subarray(start,end))}function BufferReadUInt8(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;return buf[offset]}function _readUInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len){return}else if(offset+1===len){var dv=new xDataView(new xArrayBuffer(2));dv.setUint8(0,buf[len-1]);return dv.getUint16(0,littleEndian)}else{return buf._dataview.getUint16(offset,littleEndian)}}function BufferReadUInt16LE(offset,noAssert){return _readUInt16(this,offset,true,noAssert)}function BufferReadUInt16BE(offset,noAssert){return _readUInt16(this,offset,false,noAssert)}function _readUInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len){return}else if(offset+3>=len){var dv=new xDataView(new xArrayBuffer(4));for(var i=0;i+offset<len;i++){dv.setUint8(i,buf[i+offset])}return dv.getUint32(0,littleEndian)}else{return buf._dataview.getUint32(offset,littleEndian)}}function BufferReadUInt32LE(offset,noAssert){return _readUInt32(this,offset,true,noAssert)}function BufferReadUInt32BE(offset,noAssert){return _readUInt32(this,offset,false,noAssert)}function BufferReadInt8(offset,noAssert){var buf=this;if(!noAssert){assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to read beyond buffer length")}if(offset>=buf.length)return;return buf._dataview.getInt8(offset)}function _readInt16(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len){return}else if(offset+1===len){var dv=new xDataView(new xArrayBuffer(2));dv.setUint8(0,buf[len-1]);return dv.getInt16(0,littleEndian)}else{return buf._dataview.getInt16(offset,littleEndian)}}function BufferReadInt16LE(offset,noAssert){return _readInt16(this,offset,true,noAssert)}function BufferReadInt16BE(offset,noAssert){return _readInt16(this,offset,false,noAssert)}function _readInt32(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to read beyond buffer length")}var len=buf.length;if(offset>=len){return}else if(offset+3>=len){var dv=new xDataView(new xArrayBuffer(4));for(var i=0;i+offset<len;i++){dv.setUint8(i,buf[i+offset])}return dv.getInt32(0,littleEndian)}else{return buf._dataview.getInt32(offset,littleEndian)}}function BufferReadInt32LE(offset,noAssert){return _readInt32(this,offset,true,noAssert)}function BufferReadInt32BE(offset,noAssert){return _readInt32(this,offset,false,noAssert)}function _readFloat(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+3<buf.length,"Trying to read beyond buffer length")}return buf._dataview.getFloat32(offset,littleEndian)}function BufferReadFloatLE(offset,noAssert){return _readFloat(this,offset,true,noAssert)}function BufferReadFloatBE(offset,noAssert){return _readFloat(this,offset,false,noAssert)}function _readDouble(buf,offset,littleEndian,noAssert){if(!noAssert){assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset+7<buf.length,"Trying to read beyond buffer length")}return buf._dataview.getFloat64(offset,littleEndian)}function BufferReadDoubleLE(offset,noAssert){return _readDouble(this,offset,true,noAssert)}function BufferReadDoubleBE(offset,noAssert){return _readDouble(this,offset,false,noAssert)}function BufferWriteUInt8(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset>=buf.length)return;buf[offset]=value}function _writeUInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"trying to write beyond buffer length");verifuint(value,65535)}var len=buf.length;if(offset>=len){return}else if(offset+1===len){var dv=new xDataView(new xArrayBuffer(2));dv.setUint16(0,value,littleEndian);buf[offset]=dv.getUint8(0)}else{buf._dataview.setUint16(offset,value,littleEndian)}}function BufferWriteUInt16LE(value,offset,noAssert){_writeUInt16(this,value,offset,true,noAssert)}function BufferWriteUInt16BE(value,offset,noAssert){_writeUInt16(this,value,offset,false,noAssert)}function _writeUInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"trying to write beyond buffer length");verifuint(value,4294967295)}var len=buf.length;if(offset>=len){return}else if(offset+3>=len){var dv=new xDataView(new xArrayBuffer(4));dv.setUint32(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setUint32(offset,value,littleEndian)}}function BufferWriteUInt32LE(value,offset,noAssert){_writeUInt32(this,value,offset,true,noAssert)}function BufferWriteUInt32BE(value,offset,noAssert){_writeUInt32(this,value,offset,false,noAssert)}function BufferWriteInt8(value,offset,noAssert){var buf=this;if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset<buf.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(offset>=buf.length)return;buf._dataview.setInt8(offset,value)}function _writeInt16(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+1<buf.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}var len=buf.length;if(offset>=len){return}else if(offset+1===len){var dv=new xDataView(new xArrayBuffer(2));dv.setInt16(0,value,littleEndian);buf[offset]=dv.getUint8(0)}else{buf._dataview.setInt16(offset,value,littleEndian)}}function BufferWriteInt16LE(value,offset,noAssert){_writeInt16(this,value,offset,true,noAssert)}function BufferWriteInt16BE(value,offset,noAssert){_writeInt16(this,value,offset,false,noAssert)}function _writeInt32(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}var len=buf.length;if(offset>=len){return}else if(offset+3>=len){var dv=new xDataView(new xArrayBuffer(4));dv.setInt32(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setInt32(offset,value,littleEndian)}}function BufferWriteInt32LE(value,offset,noAssert){_writeInt32(this,value,offset,true,noAssert)}function BufferWriteInt32BE(value,offset,noAssert){_writeInt32(this,value,offset,false,noAssert)}function _writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+3<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}var len=buf.length;if(offset>=len){return}else if(offset+3>=len){var dv=new xDataView(new xArrayBuffer(4));dv.setFloat32(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setFloat32(offset,value,littleEndian)}}function BufferWriteFloatLE(value,offset,noAssert){_writeFloat(this,value,offset,true,noAssert)}function BufferWriteFloatBE(value,offset,noAssert){_writeFloat(this,value,offset,false,noAssert)}function _writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){assert(value!==undefined&&value!==null,"missing value");assert(typeof littleEndian==="boolean","missing or invalid endian");assert(offset!==undefined&&offset!==null,"missing offset");assert(offset+7<buf.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}var len=buf.length;if(offset>=len){return}else if(offset+7>=len){var dv=new xDataView(new xArrayBuffer(8));dv.setFloat64(0,value,littleEndian);for(var i=0;i+offset<len;i++){buf[i+offset]=dv.getUint8(i)}}else{buf._dataview.setFloat64(offset,value,littleEndian)}}function BufferWriteDoubleLE(value,offset,noAssert){_writeDouble(this,value,offset,true,noAssert)}function BufferWriteDoubleBE(value,offset,noAssert){_writeDouble(this,value,offset,false,noAssert)}function BufferFill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(typeof value==="string"){value=value.charCodeAt(0)}if(typeof value!=="number"||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}for(var i=start;i<end;i++){this[i]=value}}function BufferInspect(){var out=[];var len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"}function BufferToArrayBuffer(){return new Buffer(this).buffer}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function _browserSupport(){var arr=new xUint8Array(0);arr.foo=function(){return 42};try{return 42===arr.foo()}catch(e){return false}}function ProxyBuffer(arr){this._arr=arr;if(arr.byteLength!==0)this._dataview=new xDataView(arr.buffer,arr.byteOffset,arr.byteLength)}ProxyBuffer.prototype.write=BufferWrite;ProxyBuffer.prototype.toString=BufferToString;ProxyBuffer.prototype.toLocaleString=BufferToString;ProxyBuffer.prototype.toJSON=BufferToJSON;ProxyBuffer.prototype.copy=BufferCopy;ProxyBuffer.prototype.slice=BufferSlice;ProxyBuffer.prototype.readUInt8=BufferReadUInt8;ProxyBuffer.prototype.readUInt16LE=BufferReadUInt16LE;ProxyBuffer.prototype.readUInt16BE=BufferReadUInt16BE;ProxyBuffer.prototype.readUInt32LE=BufferReadUInt32LE;ProxyBuffer.prototype.readUInt32BE=BufferReadUInt32BE;ProxyBuffer.prototype.readInt8=BufferReadInt8;ProxyBuffer.prototype.readInt16LE=BufferReadInt16LE;ProxyBuffer.prototype.readInt16BE=BufferReadInt16BE;ProxyBuffer.prototype.readInt32LE=BufferReadInt32LE;ProxyBuffer.prototype.readInt32BE=BufferReadInt32BE;ProxyBuffer.prototype.readFloatLE=BufferReadFloatLE;ProxyBuffer.prototype.readFloatBE=BufferReadFloatBE;ProxyBuffer.prototype.readDoubleLE=BufferReadDoubleLE;ProxyBuffer.prototype.readDoubleBE=BufferReadDoubleBE;ProxyBuffer.prototype.writeUInt8=BufferWriteUInt8;ProxyBuffer.prototype.writeUInt16LE=BufferWriteUInt16LE;ProxyBuffer.prototype.writeUInt16BE=BufferWriteUInt16BE;ProxyBuffer.prototype.writeUInt32LE=BufferWriteUInt32LE;ProxyBuffer.prototype.writeUInt32BE=BufferWriteUInt32BE;ProxyBuffer.prototype.writeInt8=BufferWriteInt8;ProxyBuffer.prototype.writeInt16LE=BufferWriteInt16LE;ProxyBuffer.prototype.writeInt16BE=BufferWriteInt16BE;ProxyBuffer.prototype.writeInt32LE=BufferWriteInt32LE;ProxyBuffer.prototype.writeInt32BE=BufferWriteInt32BE;ProxyBuffer.prototype.writeFloatLE=BufferWriteFloatLE;ProxyBuffer.prototype.writeFloatBE=BufferWriteFloatBE;ProxyBuffer.prototype.writeDoubleLE=BufferWriteDoubleLE;ProxyBuffer.prototype.writeDoubleBE=BufferWriteDoubleBE;ProxyBuffer.prototype.fill=BufferFill;ProxyBuffer.prototype.inspect=BufferInspect;ProxyBuffer.prototype.toArrayBuffer=BufferToArrayBuffer;ProxyBuffer.prototype._isBuffer=true;ProxyBuffer.prototype.subarray=function(){return this._arr.subarray.apply(this._arr,arguments)};ProxyBuffer.prototype.set=function(){return this._arr.set.apply(this._arr,arguments)};var ProxyHandler={get:function(target,name){if(name in target)return target[name];else return target._arr[name]},set:function(target,name,value){target._arr[name]=value}};function augment(arr){if(browserSupport===undefined){browserSupport=_browserSupport()}if(browserSupport){arr.write=BufferWrite;arr.toString=BufferToString;arr.toLocaleString=BufferToString;arr.toJSON=BufferToJSON;arr.copy=BufferCopy;arr.slice=BufferSlice;arr.readUInt8=BufferReadUInt8;arr.readUInt16LE=BufferReadUInt16LE;arr.readUInt16BE=BufferReadUInt16BE;arr.readUInt32LE=BufferReadUInt32LE;arr.readUInt32BE=BufferReadUInt32BE;arr.readInt8=BufferReadInt8;arr.readInt16LE=BufferReadInt16LE;arr.readInt16BE=BufferReadInt16BE;arr.readInt32LE=BufferReadInt32LE;arr.readInt32BE=BufferReadInt32BE;arr.readFloatLE=BufferReadFloatLE;arr.readFloatBE=BufferReadFloatBE;arr.readDoubleLE=BufferReadDoubleLE;arr.readDoubleBE=BufferReadDoubleBE;arr.writeUInt8=BufferWriteUInt8;arr.writeUInt16LE=BufferWriteUInt16LE;arr.writeUInt16BE=BufferWriteUInt16BE;arr.writeUInt32LE=BufferWriteUInt32LE;arr.writeUInt32BE=BufferWriteUInt32BE;arr.writeInt8=BufferWriteInt8;arr.writeInt16LE=BufferWriteInt16LE;arr.writeInt16BE=BufferWriteInt16BE;arr.writeInt32LE=BufferWriteInt32LE;arr.writeInt32BE=BufferWriteInt32BE;arr.writeFloatLE=BufferWriteFloatLE;arr.writeFloatBE=BufferWriteFloatBE;arr.writeDoubleLE=BufferWriteDoubleLE;arr.writeDoubleBE=BufferWriteDoubleBE;arr.fill=BufferFill;arr.inspect=BufferInspect;arr.toArrayBuffer=BufferToArrayBuffer;arr._isBuffer=true;if(arr.byteLength!==0)arr._dataview=new xDataView(arr.buffer,arr.byteOffset,arr.byteLength);return arr}else{var proxyBuffer=new ProxyBuffer(arr);var proxy=new Proxy(proxyBuffer,ProxyHandler);proxyBuffer._proxy=proxy;return proxy}}function clamp(index,len,defaultValue){if(typeof index!=="number")return defaultValue;index=~~index;if(index>=len)return len;if(index>=0)return index;index+=len;if(index>=0)return index;return 0}function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert(typeof value=="number","cannot write a non-number as a number");assert(value>=0,"specified a negative value for writing an unsigned value");assert(value<=max,"value is larger than maximum value for type");assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value");assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert(typeof value=="number","cannot write a non-number as a number");assert(value<=max,"value larger than maximum allowed value");assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}},{"base64-js":3,typedarray:4}],"native-buffer-browserify":[function(require,module,exports){module.exports=require("PcZj9L")},{}],3:[function(require,module,exports){(function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64
})()},{}],4:[function(require,module,exports){var undefined=void 0;var MAX_ARRAY_LENGTH=1e5;var ECMAScript=function(){var opts=Object.prototype.toString,ophop=Object.prototype.hasOwnProperty;return{Class:function(v){return opts.call(v).replace(/^\[object *|\]$/g,"")},HasProperty:function(o,p){return p in o},HasOwnProperty:function(o,p){return ophop.call(o,p)},IsCallable:function(o){return typeof o==="function"},ToInt32:function(v){return v>>0},ToUint32:function(v){return v>>>0}}}();var LN2=Math.LN2,abs=Math.abs,floor=Math.floor,log=Math.log,min=Math.min,pow=Math.pow,round=Math.round;function configureProperties(obj){if(getOwnPropertyNames&&defineProperty){var props=getOwnPropertyNames(obj),i;for(i=0;i<props.length;i+=1){defineProperty(obj,props[i],{value:obj[props[i]],writable:false,enumerable:false,configurable:false})}}}var defineProperty=Object.defineProperty||function(o,p,desc){if(!o===Object(o))throw new TypeError("Object.defineProperty called on non-object");if(ECMAScript.HasProperty(desc,"get")&&Object.prototype.__defineGetter__){Object.prototype.__defineGetter__.call(o,p,desc.get)}if(ECMAScript.HasProperty(desc,"set")&&Object.prototype.__defineSetter__){Object.prototype.__defineSetter__.call(o,p,desc.set)}if(ECMAScript.HasProperty(desc,"value")){o[p]=desc.value}return o};var getOwnPropertyNames=Object.getOwnPropertyNames||function getOwnPropertyNames(o){if(o!==Object(o))throw new TypeError("Object.getOwnPropertyNames called on non-object");var props=[],p;for(p in o){if(ECMAScript.HasOwnProperty(o,p)){props.push(p)}}return props};function makeArrayAccessors(obj){if(!defineProperty){return}if(obj.length>MAX_ARRAY_LENGTH)throw new RangeError("Array too large for polyfill");function makeArrayAccessor(index){defineProperty(obj,index,{get:function(){return obj._getter(index)},set:function(v){obj._setter(index,v)},enumerable:true,configurable:false})}var i;for(i=0;i<obj.length;i+=1){makeArrayAccessor(i)}}function as_signed(value,bits){var s=32-bits;return value<<s>>s}function as_unsigned(value,bits){var s=32-bits;return value<<s>>>s}function packI8(n){return[n&255]}function unpackI8(bytes){return as_signed(bytes[0],8)}function packU8(n){return[n&255]}function unpackU8(bytes){return as_unsigned(bytes[0],8)}function packU8Clamped(n){n=round(Number(n));return[n<0?0:n>255?255:n&255]}function packI16(n){return[n>>8&255,n&255]}function unpackI16(bytes){return as_signed(bytes[0]<<8|bytes[1],16)}function packU16(n){return[n>>8&255,n&255]}function unpackU16(bytes){return as_unsigned(bytes[0]<<8|bytes[1],16)}function packI32(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}function unpackI32(bytes){return as_signed(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packU32(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}function unpackU32(bytes){return as_unsigned(bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],32)}function packIEEE754(v,ebits,fbits){var bias=(1<<ebits-1)-1,s,e,f,ln,i,bits,str,bytes;function roundToEven(n){var w=floor(n),f=n-w;if(f<.5)return w;if(f>.5)return w+1;return w%2?w+1:w}if(v!==v){e=(1<<ebits)-1;f=pow(2,fbits-1);s=0}else if(v===Infinity||v===-Infinity){e=(1<<ebits)-1;f=0;s=v<0?1:0}else if(v===0){e=0;f=0;s=1/v===-Infinity?1:0}else{s=v<0;v=abs(v);if(v>=pow(2,1-bias)){e=min(floor(log(v)/LN2),1023);f=roundToEven(v/pow(2,e)*pow(2,fbits));if(f/pow(2,fbits)>=2){e=e+1;f=1}if(e>bias){e=(1<<ebits)-1;f=0}else{e=e+bias;f=f-pow(2,fbits)}}else{e=0;f=roundToEven(v/pow(2,1-bias-fbits))}}bits=[];for(i=fbits;i;i-=1){bits.push(f%2?1:0);f=floor(f/2)}for(i=ebits;i;i-=1){bits.push(e%2?1:0);e=floor(e/2)}bits.push(s?1:0);bits.reverse();str=bits.join("");bytes=[];while(str.length){bytes.push(parseInt(str.substring(0,8),2));str=str.substring(8)}return bytes}function unpackIEEE754(bytes,ebits,fbits){var bits=[],i,j,b,str,bias,s,e,f;for(i=bytes.length;i;i-=1){b=bytes[i-1];for(j=8;j;j-=1){bits.push(b%2?1:0);b=b>>1}}bits.reverse();str=bits.join("");bias=(1<<ebits-1)-1;s=parseInt(str.substring(0,1),2)?-1:1;e=parseInt(str.substring(1,1+ebits),2);f=parseInt(str.substring(1+ebits),2);if(e===(1<<ebits)-1){return f!==0?NaN:s*Infinity}else if(e>0){return s*pow(2,e-bias)*(1+f/pow(2,fbits))}else if(f!==0){return s*pow(2,-(bias-1))*(f/pow(2,fbits))}else{return s<0?-0:0}}function unpackF64(b){return unpackIEEE754(b,11,52)}function packF64(v){return packIEEE754(v,11,52)}function unpackF32(b){return unpackIEEE754(b,8,23)}function packF32(v){return packIEEE754(v,8,23)}(function(){var ArrayBuffer=function ArrayBuffer(length){length=ECMAScript.ToInt32(length);if(length<0)throw new RangeError("ArrayBuffer size is not a small enough positive integer");this.byteLength=length;this._bytes=[];this._bytes.length=length;var i;for(i=0;i<this.byteLength;i+=1){this._bytes[i]=0}configureProperties(this)};exports.ArrayBuffer=exports.ArrayBuffer||ArrayBuffer;var ArrayBufferView=function ArrayBufferView(){};function makeConstructor(bytesPerElement,pack,unpack){var ctor;ctor=function(buffer,byteOffset,length){var array,sequence,i,s;if(!arguments.length||typeof arguments[0]==="number"){this.length=ECMAScript.ToInt32(arguments[0]);if(length<0)throw new RangeError("ArrayBufferView size is not a small enough positive integer");this.byteLength=this.length*this.BYTES_PER_ELEMENT;this.buffer=new ArrayBuffer(this.byteLength);this.byteOffset=0}else if(typeof arguments[0]==="object"&&arguments[0].constructor===ctor){array=arguments[0];this.length=array.length;this.byteLength=this.length*this.BYTES_PER_ELEMENT;this.buffer=new ArrayBuffer(this.byteLength);this.byteOffset=0;for(i=0;i<this.length;i+=1){this._setter(i,array._getter(i))}}else if(typeof arguments[0]==="object"&&!(arguments[0]instanceof ArrayBuffer||ECMAScript.Class(arguments[0])==="ArrayBuffer")){sequence=arguments[0];this.length=ECMAScript.ToUint32(sequence.length);this.byteLength=this.length*this.BYTES_PER_ELEMENT;this.buffer=new ArrayBuffer(this.byteLength);this.byteOffset=0;for(i=0;i<this.length;i+=1){s=sequence[i];this._setter(i,Number(s))}}else if(typeof arguments[0]==="object"&&(arguments[0]instanceof ArrayBuffer||ECMAScript.Class(arguments[0])==="ArrayBuffer")){this.buffer=buffer;this.byteOffset=ECMAScript.ToUint32(byteOffset);if(this.byteOffset>this.buffer.byteLength){throw new RangeError("byteOffset out of range")}if(this.byteOffset%this.BYTES_PER_ELEMENT){throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.")}if(arguments.length<3){this.byteLength=this.buffer.byteLength-this.byteOffset;if(this.byteLength%this.BYTES_PER_ELEMENT){throw new RangeError("length of buffer minus byteOffset not a multiple of the element size")}this.length=this.byteLength/this.BYTES_PER_ELEMENT}else{this.length=ECMAScript.ToUint32(length);this.byteLength=this.length*this.BYTES_PER_ELEMENT}if(this.byteOffset+this.byteLength>this.buffer.byteLength){throw new RangeError("byteOffset and length reference an area beyond the end of the buffer")}}else{throw new TypeError("Unexpected argument type(s)")}this.constructor=ctor;configureProperties(this);makeArrayAccessors(this)};ctor.prototype=new ArrayBufferView;ctor.prototype.BYTES_PER_ELEMENT=bytesPerElement;ctor.prototype._pack=pack;ctor.prototype._unpack=unpack;ctor.BYTES_PER_ELEMENT=bytesPerElement;ctor.prototype._getter=function(index){if(arguments.length<1)throw new SyntaxError("Not enough arguments");index=ECMAScript.ToUint32(index);if(index>=this.length){return undefined}var bytes=[],i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){bytes.push(this.buffer._bytes[o])}return this._unpack(bytes)};ctor.prototype.get=ctor.prototype._getter;ctor.prototype._setter=function(index,value){if(arguments.length<2)throw new SyntaxError("Not enough arguments");index=ECMAScript.ToUint32(index);if(index>=this.length){return undefined}var bytes=this._pack(value),i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1){this.buffer._bytes[o]=bytes[i]}};ctor.prototype.set=function(index,value){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var array,sequence,offset,len,i,s,d,byteOffset,byteLength,tmp;if(typeof arguments[0]==="object"&&arguments[0].constructor===this.constructor){array=arguments[0];offset=ECMAScript.ToUint32(arguments[1]);if(offset+array.length>this.length){throw new RangeError("Offset plus length of array is out of range")}byteOffset=this.byteOffset+offset*this.BYTES_PER_ELEMENT;byteLength=array.length*this.BYTES_PER_ELEMENT;if(array.buffer===this.buffer){tmp=[];for(i=0,s=array.byteOffset;i<byteLength;i+=1,s+=1){tmp[i]=array.buffer._bytes[s]}for(i=0,d=byteOffset;i<byteLength;i+=1,d+=1){this.buffer._bytes[d]=tmp[i]}}else{for(i=0,s=array.byteOffset,d=byteOffset;i<byteLength;i+=1,s+=1,d+=1){this.buffer._bytes[d]=array.buffer._bytes[s]}}}else if(typeof arguments[0]==="object"&&typeof arguments[0].length!=="undefined"){sequence=arguments[0];len=ECMAScript.ToUint32(sequence.length);offset=ECMAScript.ToUint32(arguments[1]);if(offset+len>this.length){throw new RangeError("Offset plus length of array is out of range")}for(i=0;i<len;i+=1){s=sequence[i];this._setter(offset+i,Number(s))}}else{throw new TypeError("Unexpected argument type(s)")}};ctor.prototype.subarray=function(start,end){function clamp(v,min,max){return v<min?min:v>max?max:v}start=ECMAScript.ToInt32(start);end=ECMAScript.ToInt32(end);if(arguments.length<1){start=0}if(arguments.length<2){end=this.length}if(start<0){start=this.length+start}if(end<0){end=this.length+end}start=clamp(start,0,this.length);end=clamp(end,0,this.length);var len=end-start;if(len<0){len=0}return new this.constructor(this.buffer,this.byteOffset+start*this.BYTES_PER_ELEMENT,len)};return ctor}var Int8Array=makeConstructor(1,packI8,unpackI8);var Uint8Array=makeConstructor(1,packU8,unpackU8);var Uint8ClampedArray=makeConstructor(1,packU8Clamped,unpackU8);var Int16Array=makeConstructor(2,packI16,unpackI16);var Uint16Array=makeConstructor(2,packU16,unpackU16);var Int32Array=makeConstructor(4,packI32,unpackI32);var Uint32Array=makeConstructor(4,packU32,unpackU32);var Float32Array=makeConstructor(4,packF32,unpackF32);var Float64Array=makeConstructor(8,packF64,unpackF64);exports.Int8Array=exports.Int8Array||Int8Array;exports.Uint8Array=exports.Uint8Array||Uint8Array;exports.Uint8ClampedArray=exports.Uint8ClampedArray||Uint8ClampedArray;exports.Int16Array=exports.Int16Array||Int16Array;exports.Uint16Array=exports.Uint16Array||Uint16Array;exports.Int32Array=exports.Int32Array||Int32Array;exports.Uint32Array=exports.Uint32Array||Uint32Array;exports.Float32Array=exports.Float32Array||Float32Array;exports.Float64Array=exports.Float64Array||Float64Array})();(function(){function r(array,index){return ECMAScript.IsCallable(array.get)?array.get(index):array[index]}var IS_BIG_ENDIAN=function(){var u16array=new exports.Uint16Array([4660]),u8array=new exports.Uint8Array(u16array.buffer);return r(u8array,0)===18}();var DataView=function DataView(buffer,byteOffset,byteLength){if(arguments.length===0){buffer=new ArrayBuffer(0)}else if(!(buffer instanceof ArrayBuffer||ECMAScript.Class(buffer)==="ArrayBuffer")){throw new TypeError("TypeError")}this.buffer=buffer||new ArrayBuffer(0);this.byteOffset=ECMAScript.ToUint32(byteOffset);if(this.byteOffset>this.buffer.byteLength){throw new RangeError("byteOffset out of range")}if(arguments.length<3){this.byteLength=this.buffer.byteLength-this.byteOffset}else{this.byteLength=ECMAScript.ToUint32(byteLength)}if(this.byteOffset+this.byteLength>this.buffer.byteLength){throw new RangeError("byteOffset and length reference an area beyond the end of the buffer")}configureProperties(this)};function makeGetter(arrayType){return function(byteOffset,littleEndian){byteOffset=ECMAScript.ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength){throw new RangeError("Array index out of range")}byteOffset+=this.byteOffset;var uint8Array=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),bytes=[],i;for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1){bytes.push(r(uint8Array,i))}if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)){bytes.reverse()}return r(new arrayType(new Uint8Array(bytes).buffer),0)}}DataView.prototype.getUint8=makeGetter(exports.Uint8Array);DataView.prototype.getInt8=makeGetter(exports.Int8Array);DataView.prototype.getUint16=makeGetter(exports.Uint16Array);DataView.prototype.getInt16=makeGetter(exports.Int16Array);DataView.prototype.getUint32=makeGetter(exports.Uint32Array);DataView.prototype.getInt32=makeGetter(exports.Int32Array);DataView.prototype.getFloat32=makeGetter(exports.Float32Array);DataView.prototype.getFloat64=makeGetter(exports.Float64Array);function makeSetter(arrayType){return function(byteOffset,value,littleEndian){byteOffset=ECMAScript.ToUint32(byteOffset);if(byteOffset+arrayType.BYTES_PER_ELEMENT>this.byteLength){throw new RangeError("Array index out of range")}var typeArray=new arrayType([value]),byteArray=new Uint8Array(typeArray.buffer),bytes=[],i,byteView;for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1){bytes.push(r(byteArray,i))}if(Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)){bytes.reverse()}byteView=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT);byteView.set(bytes)}}DataView.prototype.setUint8=makeSetter(exports.Uint8Array);DataView.prototype.setInt8=makeSetter(exports.Int8Array);DataView.prototype.setUint16=makeSetter(exports.Uint16Array);DataView.prototype.setInt16=makeSetter(exports.Int16Array);DataView.prototype.setUint32=makeSetter(exports.Uint32Array);DataView.prototype.setInt32=makeSetter(exports.Int32Array);DataView.prototype.setFloat32=makeSetter(exports.Float32Array);DataView.prototype.setFloat64=makeSetter(exports.Float64Array);exports.DataView=exports.DataView||DataView})()},{}]},{},[]);module.exports=require("native-buffer-browserify").Buffer},{}],39:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],40:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],41:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],42:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":40,"./encode":41}]},{},[]);